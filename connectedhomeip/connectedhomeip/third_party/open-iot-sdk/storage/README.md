# Open IoT SDK storage components

## Overview

This repository is a collection of storage components for the Open IoT SDK:
* `blockdevice/`: BlockDevice API and implementations

## Examples

Each storage component's examples can be found in its `examples` subdirectory.

To configure and build all examples for Corstone-300 AN552 which is the current default
platform, run from the top level of this repository:

```
# Replace <TOOLCHAIN_FILE> with toolchains/toolchain-arm-none-eabi-gcc.cmake or toolchains/toolchain-armclang.cmake
cmake -S . -B examples_build -GNinja --toolchain=<TOOLCHAIN_FILE> -DCMAKE_SYSTEM_PROCESSOR=cortex-m55 -DIOTSDK_MDH_ARM=ON -DIOTSDK_STORAGE_BUILD_EXAMPLES=ON
cmake --build examples_build
```

This produces an .elf image for each example that you can manually run with an FVP, for example
```
# Replace <PATH_TO> with the FVP's installation path
/<PATH_TO>/FVP_Corstone_SSE-300_Ethos-U55 examples_build/blockdevice/examples/FlashIAPBlockDevice/iotsdk-example-blockdevice.elf
```

Optionally, you can automate the running of all examples as a form of integration testing.
To do this, add `-D HTRUN_ARGUMENTS="--micro=FVP_CS300_U55;--fm=MPS3;--sync=0;--baud-rate=115200"`
to the CMake configuration command, and run all examples (after building them) with
```
ctest --test-dir examples_build -V
```

## Unit tests

To build unit tests,

```
cmake -S . -B unit_build -GNinja
cmake --build unit_build
```

To run all unit tests,

```
ctest --test-dir unit_build -V
```

### Generating a test coverage report

To enable test coverage, either add `-DOPT_ENABLE_COVERAGE=ON` to the CMake configuration
command or [enable the developer mode](#Enabling-developer-mode). Then build and run all unit tests.
A coverage report can then be generated by running

```
gcovr --exclude "(.*)/_deps/" --exclude-unreachable-branches --print-summary
```

**Note**: If your local repository has pre-commit enabled as per [`CONTRIBUTING.md`](./CONTRIBUTING.md),
a coverage report is automatically generated and checked against the threshold every time you create a git
commit.

## Enabling developer mode

A *developer mode* provided by the CMake library [project_options](https://github.com/cpp-best-practices/project_options#changing-the-project_options-dynamically)
turns on a number of options and checks aimed at improving code quality. This mode is off by default
for production code but you can enable it by adding `-DENABLE_DEVELOPER_MODE=ON` to the CMake
configuration command.

**Note**: The developer mode is restricted to native builds such as unit tests, because
most options do not work with cross compilation.

The following are enabled in the developer mode:
* test coverage generation
* cppcheck
* include-what-you-use
* clang-tidy
* address sanitizer
* leak sanitizer
* undefined behavior sanitizer
* test coverage generation

## Generating documentation with Doxygen

To generate HTML documentation pages from all API headers and Markdown (.md) files in this repository,
[enable the developer mode](#Enabling-developer-mode) with `-DENABLE_DEVELOPER_MODE=ON` and add
`-DOPT_ENABLE_DOXYGEN=ON` to the CMake configuration command of a native build:

```
cmake -S . -B __build -GNinja -DENABLE_DEVELOPER_MODE=ON -DOPT_ENABLE_DOXYGEN=ON
```

The target for docs is `doxygen-docs` which is automatically built along with other targets by default.
To build docs only, pass `--target doxygen-docs` to the build command:

```
cmake --build __build --target doxygen-docs
```

The output can be found in the `html` directory of the build, and from there the index page is `index.html`
which can be viewed using a web browser.

## License and contributions

The software is provided under the Apache-2.0 license. All contributions to software and documents are licensed by contributors under the same license model as the software/document itself (ie. inbound == outbound licensing). Open IoT SDK may reuse software already licensed under another license, provided the license is permissive in nature and compatible with Apache v2.0.

Folders containing files under different permissive license than Apache 2.0 are listed in the LICENSE file.

Please see [CONTRIBUTING.md](CONTRIBUTING.md) for more information.

## Security issues reporting

If you find any security vulnerabilities, please do not report it in the GitLab issue tracker. Instead, send an email to the security team at arm-security@arm.com stating that you may have found a security vulnerability in the Open IoT SDK storage component.

More details can be found at [Arm Developer website](https://developer.arm.com/support/arm-security-updates/report-security-vulnerabilities).
